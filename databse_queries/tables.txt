CREATE TABLE `student` (
  `id` INT AUTO_INCREMENT PRIMARY KEY,
  `reg_number` VARCHAR(20) NOT NULL UNIQUE,
  `index_number` VARCHAR(20) NOT NULL UNIQUE,
  `name_with_initials` VARCHAR(100) NOT NULL,
  `address` TEXT NOT NULL,
  `contact_number` VARCHAR(15) NOT NULL,
  `created_date` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `users` (
  `user_id` INT AUTO_INCREMENT PRIMARY KEY,
  `username` VARCHAR(50) NOT NULL UNIQUE,
  `password` VARCHAR(255) NOT NULL,
  `user_type` VARCHAR(20) NOT NULL DEFAULT 'staff',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `tickets` (
  `ticket_id` INT AUTO_INCREMENT PRIMARY KEY,
  `ticket_number` VARCHAR(20) NOT NULL UNIQUE,
  `student_reg_number` VARCHAR(20) NOT NULL,
  `description` TEXT NOT NULL,
  `question_date` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `status` ENUM('pending','completed') NOT NULL DEFAULT 'pending',
  FOREIGN KEY (`student_reg_number`) REFERENCES `student`(`reg_number`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `reply` (
  `reply_id` INT AUTO_INCREMENT PRIMARY KEY,
  `ticket_number` VARCHAR(20) NOT NULL,
  `description` TEXT NOT NULL,
  `replied_by` VARCHAR(100) NOT NULL,
  `replied_date` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`ticket_number`) REFERENCES `tickets`(`ticket_number`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

ALTER TABLE `student` 
ADD COLUMN `password` VARCHAR(255) NOT NULL AFTER `contact_number`;

ALTER TABLE student 
CHANGE COLUMN address town TEXT NOT NULL;